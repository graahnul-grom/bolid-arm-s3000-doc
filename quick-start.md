# bolid-arm-s3000-doc / quick-start

# АРМ С3000: быстрый старт



<!-- NOTE marks:

    - todo
      - in visible text: **TODO**: <description>
      - in comments: TODO

    - screenshot here
      - in visible text: **SS**
      - in separate 1-line comment:
-->

<!-- SS -->

<!--

-->

<!-- NOTE replacements:

    - - => — // long
    - "" => «» .. TODO regexp to replace

    - **iso**     => **ИСО Орион** // TODO give transcript on 1st use
    - **s3k**     => **АРМ С3000** // TODO give transcript on 1st use
    - **s2k-eth** => **С2000-Ethernet**
    - **s2km**    => **С2000М**
    -                **С2000М исп. 02**
    - `Орион`     => `Орион`     // protocol
    - `Орион Про` => `Орион Про` // protocol

    - `UProg`
      **UProg**
      [UProg](https://bolid.ru/production/orion/po-orion/po-config/uprog.html)
    - `PProg`
      **PProg**
      [UProg](https://bolid.ru/production/orion/po-orion/po-config/pprog.html)

      [s3k-re x.x.x yyy pNNN]()     => links to s3k manual
      [s2k-eth-re x.x.x yyy pNNN]() => links to s2k-eth manual
      [XXX-re x.x.x yyy pNNN]()     => links to XXX manual
-->

<!-- src: `Инструкция по быстрому старту АРМ С3000 23_03_02.pdf` -->

<!--
## TOC: original

- 1 Установка ПО
- 2 Подключение к системе
- 3 Дата и время
- 4 Использование https протокола. Установка SSL сертификата
  - 4.1 Генерация самоподписанного сертификата
  - 4.2 Установка сертификата в ОС Windows
  - 4.3 Включение доступа к системе по https
- 5 Подключение устройств
- 6 Настройка пульта для работы с «АРМ С3000»
- 7 Подключение устройств за «С2000-Ethernet». Создание порта «С2000-Ethernet»
- 8 Создание линий
- 9 Конфигурация устройств
  - 9.1 Чтение конфигурации из пульта
  - 9.2 Создание конфигурации для пульта
  - 9.3 Создание конфигурации для линии без пульта
  - 9.4 Загрузка конфигураций в АРМ С3000
  - 9.5 Применение конфигураций в АРМ С3000
- 10 Рассылка уведомлений. Настройка Телеграмм бота
- 11 Добавление новых пользователей
- 12 Штатное использование
-->



<!--
## TOC: WIP

- Введение
- Соглашения и условные обозначения
- Сокращения
- Установка ПО
  - supported OS
  - link:
    - docker-linux.md
    - docker-windows.md
    - win.md
- Подключение к системе
  - localhost
  - http port
  - mention port forwarding // ?
  - default login/password
- Дата и время
  - important for:
    - s2km
    - telegram bot
- Использование защищенного соединения // was: протокола https
  - important, highly recommended (that's why it here)
  - generate self-signed certificate (web-interface)
  - download generated cert
  - install cert (Windows): to "Trusted Root Certification Authorities"
- Подключение устройств
  - Общие сведения
    - interfaces
    - converters
    - port definition
    - line definition
    - protocols
    - speed
  - Настройка пульта
  - Подключение устройств через **s2k-eth**
    - Настройка прибора **s2k-eth**
    - Добавление порта **s2k-eth** в web-интерфейсе

- "Режим конфигурации" - manual 2.3.5.1, p.71
                                         p.82
  - on pages: devices, staff, configs
  - config can be *applied* to:
    - *line*                     working on top of the `orion` proto
    - *s2km* connected to *line* working on top of the `orion pro` proto
      && if *s2km* has been *added* to **s3k** database
-->



<!--
## TOC: actual

- Введение
- Соглашения и условные обозначения
- Сокращения
- Установка **s3k**
- Подключение и вход в систему
- Дата и время
- Использование защищенного соединения
- Подключение устройств
- Настройка пульта для работы с **s3k**
- Подключение устройств через **s2k-eth**
- Создание и свойства линии
- Работа с конфигурациями пультов
  - Сохранение пульта в базе данных **s3k**
  - Загрузка конфигурации пульта в **s3k**
  - Чтение конфигурации из пульта, подключенного к **s3k**
  - Применение загруженной конфигурации к пульту
  - Применение загруженной конфигурации к линии без пульта
- Добавление пользователей
- Рассылка уведомлений. Telegram
-->

<!--
## TOC: rearrange

- Введение
- Соглашения и условные обозначения
- Сокращения
- Установка **s3k**
- Подключение и вход в систему
- Дата и время

- Подключение устройств
  - give a name: intro // способы подключения устройств // общие сведения
  - Создание и свойства линии
  - Настройка пульта для работы с **s3k**
  - rename: Подключение устройств через **s2k-eth**

- Работа с конфигурациями пультов
  - Сохранение пульта в базе данных **s3k**
  - Загрузка конфигурации пульта в **s3k**
  - Чтение конфигурации из пульта, подключенного к **s3k**
  - Применение загруженной конфигурации к пульту
  - Применение загруженной конфигурации к линии без пульта
- Использование защищенного соединения
- Добавление пользователей
- Рассылка уведомлений. Telegram
  - intro: list actions needed
  - КУ, фильтры
  - Создание бота
  - Регистрация созданного бота в **s3k**
  - Создание пользователя бота
  - Привязка учетной записи (авторизация?) пользователя бота (tg user <-> bot?)
-->



## Введение

<!-- TODO short description -->

Руководство призвано возможно быстрее ввести читателя
в курс дела, познакомив с особенностями
и наиболее значимыми настройками
новой системы «АРМ С3000»
и позволить начать ее эксплуатацию.

Документ предназначен для технических специалистов, имеющих опыт работы
с программными продуктами и аппаратными средствами разработки
компании **Bolid**. Следует быть знакомым
с использованием и настройкой таких приборов, как пульт
**s2km** и преобразователь **s2k-eth**, а также
программами их настройки - `PProg` и `UProg`.
Помощь в понимании окажет и знакомство с АРМ **Орион Про**.

Описывая вкратце тот или иной аспект системы, мы будем
приводить ссылки на соответствующие разделы руководства
пользователя и других документов, содержащих
более подробную информацию и справочные данные.

При изложении материала будем ориентироваться,
в основном, на наиболее типичный сценарий:
в распоряжении пользователя находиться объект,
охваченный пожарными и/или охранными системами
приборов **iso** и контролируемыми,
как правило, с помощью пульта **s2km**.

Нашей целью будет являться настройка **s3k** для управления такой
системой, отображения состояния входящих в нее элементов и
получения уведомлений о происходящих событиях.

<!--
Руководство именуется "быстрым стартом", что отражает главную
его цель: по возможности, быстрее вести читателя в курс дела,
ознакомить с новой системой и позволить начать её эксплуатацию.

Предназначено для технических специалистов, имеющих опыт работы
с программными продуктами и аппаратными средствами разработки
компании **Bolid**.

Не берясь во всей полноте раскрыть здесь возможности **s3k** и
описать параметры конфигурации, мы, тем не менее,
выделим основные моменты, касающиеся и того, и другого.

Описывая вкратце тот или иной аспект системы, мы будем
приводить ссылки на соответствующие разделы руководства
по эксплуатации и других документов, где можно будет
найти более подробную информацию и справочные данные.
-->

<!-- TODO r/o fire alarm systems; should we explain why -->



## Соглашения и условные обозначения

<!-- (~N) - footnote number N reference, e.g. (~1) (~2); ~N - footnote itself -->

- Словом *пульт* будем обозначать устройства пультов `С2000М` и
  `С2000М исп. 02`, оговаривая, где это необходимо, различия между ними.
- Ссылаясь в тексте на *Руководство по эксплуатации* (или просто *Руководство*),
  мы имеем в виду соответствующий документ с описанием **s3k**.
- **Полужирным** шрифтом выделяются названия программных продуктов
  и аппаратных средств.
- *Курсив* применяется для обозначения технических терминов
  и в иных случаях для выделения частей текста.
- **Внимание:**
  так обозначены важные замечания.
- **Примечание:**
  краткие аннотации к основному тексту.



## Сокращения

АРМ — автоматизированное рабочее место<br />
БД — база данных<br />
ИСО — интегрированная системы охраны<br />
КУ — канал уведомлений<br />
ОС — операционная система<br />
ПО — программное обеспечение



## Установка **s3k**

**s3k** поставляется в виде образов **Docker** для систем
Windows и Linux, а также программы установки **s3k**
в качестве службы (service) для ОС Windows.

Поддерживаются несколько дистрибутивов Linux, в том числе
Alpine, Astra и Ubuntu нескольких версий.

Системные требования и инструкции по установке
содержатся в соответствующих документах:

- [Установка образов Docker в ОС Linux](docker-linux.md)
- [установка образов Docker в ОС Windows](docker-windows.md)
- [Установка в ОС Windows](win.md)



## Подключение и вход в систему

После запуска, **s3k** будет доступна на всех сетевых интерфейсах
по протоколу HTTP. Порт для соединения задайтся при установке
(см. раздел "Установка" выше). Например: `http://127.0.0.1:20080`.

Для доступа и работы с системой используется web-интерфейс.

При успешном подключении в браузере откроется страница входа
в систему. Следует ввести установленные изначально имя
пользователя ("admin") и пароль ("armS3000").

Данные учетной записи `admin` рекомендуется сразу же изменить,
задав новый пароль.

Также следует рассмотреть переход на защищенное соединение
по протоколу HTTPS (см. "Использование защищенного соединения").



## Дата и время

Важно убедиться в том, что часовой пояс, дата и время на
локальной машине установлены правильно.

Это установки влияют как на работу самой системы **s3k**,
так и на подключенные устройства: при установлении соединения
им отправляется команда синхронизировать дату и время с **s3k**.

Корректные дата и время требуются также для функционирования
мессенджера Telegram (используется для рассылки уведомлений,
см. "Рассылка уведомлений. Telegram").



## Использование защищенного соединения

При работе с сетевыми приложениями, рекомендации по безопасности
включают в себя не только защиту учетной записи администратора,
но также и установление соединения по защищенному протоколу HTTPS.

В этом разделе будет рассмотрена простейшая настройка
**s3k** для организации безопасного соединения.

Прежде всего необходимо создать самоподписанный сертификат
в web-интерфейсе на странице *`Общая настройка`* →
*`SSL Сертификаты`* → *`Самоподписанный сертификат`*.

Из параметров достаточно указать IP-адрес или DNS-имя машины с **s3k**
(возможно добавление нескольких адресов и имен) и срок действия.

- **Внимание:**<br />
В системе может быть установлен лишь один сертификат.
После нажатия на кнопку "Сгенерировать" новый сертификат
будет создан и *заменит* собой установленный ранее.

Включить параметр "Доступ к устройству по протоколу https"
на странице *`Общая настройка`* → *`Сервисное обслуживание`* →
*`Прочие настройки`*, после чего система готова к приему
соединений по протоколу HTTPS.

Настроив программное обеспечение для работы по HTTPS
на рабочих станциях (см. ниже), возможность соединения
по протоколу HTTP можно отключить на этой же странице.

- **Внимание:**<br />
При изменении параметров на странице настройки, система **s3k**
перезапускается, после чего требуется произвести повторный вход
всем подключенным пользователям.

После этого можно приступить к настройке соединения со стороны клиентского ПО.
<!--
Осталось настроить соединение со стороны клиентского ПО.
Далее Осталось настроить соединение со стороны клиентского ПО.
-->

<!-- TODO other OS's => refer [s3k-re TODO where?]() -->
Для ОС Windows требуется скачать и установить созданный ранее сертификат,
нажав на странице *`Общая настройка`* → *`SSL Сертификаты`* →
*`Установленный`* кнопку "Скачать цепочку".

Открыв скачанный файл, в списке сертификатов дважды щелкнуть левой
кнопкой мыши тот, имя которого начинается с "Root CA ARM S3000".
Нажать кнопку "Установить сертификат..." и в качестве целевого хранилища
указать "Доверенные корневые центры сертификации" ("Trusted Root
Certification Authorities").

<!-- SS -->



## Подключение устройств

<!-- 2C: manual 2.2.3 Схема внешних соединений -->

Устройства **iso** могут быть подключены к **s3k** следующими способами:
1. через последовательный порт RS-232
2. через порт RS-485
3. по сети, через устройство **s2k-eth**

Приборы могут подключаются как напрямую,
так и через преобразователи интерфейсов (например, с помощью
[Универсального преобразователя интерфейсов USB-RS](https://bolid.ru/production/orion/interface-converter/usb_rs.html)
производства компании **Bolid**).

Каждому из трех перечисленных способов подключения
ставится в соответствие понятие *порт*.

**Примечание:**<br />
Обратите внимание, что в терминологии **s3k** *портом*
может являться как физическое устройство (например, COM-порт),
так и виртуальный последовательный порт, соответствующий
соединению по сети через **s2k-eth**.

Настройка производится посредством добавления *порта* -
`RS` или `С2000-Ethernet` на странице
*`Конфигурирование структуры объекта`* → *`Приборы`*.

Далее на вкладке *`Линии и протоколы`* добавляется так называемая
*линия* для подключения устройств - это определенный *порт* и набор
настроек, таких как *протокол*, скорость соединения и ряд других.
[s3k-re 2.3.5.3.1.1 Параметры линий p91]()

**Примечание:**<br />
*Порт*, задействованный в одной из линий, не может быть использован
при создании других.

Для взаимодействия с устройствами может использоваться один из двух
*протоколов*: `Орион Про` или `Орион`. Первый применяется для связи
с *пультом*, второй - при подключении приборов напрямую, без пульта.

Для протокола `Орион Про` доступны скорости
9600, 19200, 38400, 57600, 115200 бит/с;
соединение по протоколу `Орион` возможно только на скорости 9600 бит/с.



## Настройка пульта для работы с **s3k**

Убедитесь, что на пульте установлена минимально допустимая версия прошивки
и обновите ее, если необходимо, с помощью `PProg`:
- для пульта `С2000М` - не ниже 3.14 или 4.14
  (в зависимости от аппаратной версии прибора)
- для пульта `С2000М исп. 02` - не ниже 5.02

[Скачать прошивки для **s2km**](https://bolid.ru/production/orion/network-controllers/s2000m.html#download)

В настройках пульта ("параметры второго порта связи")
необходимо установить следующие значения:
- Режим: "Компьютер"
- Включить "Запрашивать состояния С2000М"
- "Скорость" должна соответствовать выбранной скорости в установках для *линии*
  (см. раздел "Создание и свойства линии" ниже)

В руководстве по эксплуатации **s2km** см. раздел "Параметры второго порта связи".

<!--
**s3k** работает с пультами
`С2000М` (интерфейсы подключения RS-232 и RS-485) и
`С2000М исп. 02` (два интерфейса RS-485)

- `С2000М`         3.14 / 4.14 - diff HW platforms
- `С2000М исп. 02` 5.02

[s3k-re 2.3.5.3.1.1 Параметры линий p91]()

В настройках пульта (самого прибора) необходимо задать следующие параметры:
- `ORIG` `BUG` Режим работы - "Компьютер"
  не *Режим работы* [s2km-re p15]()...
  - дежурный
  - пуск
  - пожар
  - etc...
- ...а  *Параметры второго порта связи -> Режим* [s2km-re p109]()
  - ПРИНТЕР
  - КОМПЬЮТЕР
  - RS-485 РЕЗЕРВ
  - ПИ/РЕЗЕРВ
  - etc...
- Включить "Запрашивать состояния"
  *Параметры второго порта связи -> Запрашивать состояния С2000М*
- `2ASK` how does it relate to **s3k**:
  Скорость, согласованную с другими приборами на линии
  *Параметры второго порта связи -> СКОРОСТЬ* [s2km-re p110]()
-->



## Подключение устройств через **s2k-eth**

Для использования **s2k-eth** с **s3k**, прибор необходимо настроить.
Настройка осуществляется с помощью утилиты `UProg`
и заключается в задании значений таких параметров:
- IP-адрес компьютера с **s3k**
- Совместимость - "Иные приборы"
- "UDP-порт удаленного устройства"
  (параметр называется "UDP-порт получателя" в версиях **s2k-eth** < 3.10)
- "Использовать один порт на прием/передачу"
  ("Использовать один порт на чтение/запись" для версий **s2k-eth** < 3.10)

<!--
**Внимание:**<br />
В зависимости от используемого прибора (его аппаратной версии),
имена некоторых параметров в окне настройки `UProg` могут
несколько отличаться.
-->

Затем в web-интерфейсе **s3k** следует добавить *порт* на странице
*`Конфигурирование структуры объекта`* → *`Приборы`* → *`Порты c2000 Ethernet`*,
установив следующие параметры
в соответствии с проведенными настройками **s2k-eth**:
- Локальный порт **s3k**
- IP или DNS адрес **s2k-eth**
- UDP порт **s2k-eth**

[s3k-re 2.3.5.3.2 Вкладка Порты C2000 Ethernet p105]()

<!-- TODO UDP port forwarding - take from docker md files -->

<!--
- from qstart: `wtf` типа порта
- from manual, `wtf` "virt. line":
-->



## Создание и свойства линии

Линия создается в web-интерфейсе на странице
*`Конфигурирование структуры объекта`* → *`Приборы`* → *`Линии и протоколы`*.

При нажатии на "Добавить линию",
в правой части окна появится список параметров создаваемой линии,
из которых основными являются *порт*, *протокол* и *скорость*.

При успешном добавлении новая линия появиться в списке
и, при установленном параметре "Включить опрос",
в течение определенного времени (~1) - устройства, подключенные к линии.

В секции "Тайминги" устанавливаются временны́е параметры для используемого порта.
В большинстве случае достаточно оставить значения по умолчанию,
но для портов типа **s2k-eth**
следует руководствоваться сведениями из раздела
"Требования и рекомендации по настройке временны́х параметров"
документации **s2k-eth**.

<!-- TODO line marks - color coding -->
<!-- TODO Опции subsection -->
<!-- TODO apply cfg button -->
<!-- TODO note on web ui f##kup: click line => props, click ">" => line contents -->

<!-- NOTE accent chars (stress marks)
- made by http://russiangram.com:<br />
1ы́3<br />
- made by win10 char map app<br />
ы̀́́́́́́́́́́<br />
1ы̀́́́́́́́́́́3<br />
-->

**Примечание:**<br />
Сообщение "Добавлено максимум линий" в списке линий
говорит о том, что все добавленные *порты* (как RS, так и **s2k-eth**)
уже используется в существующих линиях.

**Примечание:**<br />
В целях отладки, для гарантированного обнаружения устройств,
подключенных к линии, можно выставить намеренно увеличенные значения
*таймаута запроса новых событий* и *таймаута ответа на команду*,
например, 250 и 2000, соответственно. Но при штатном использовании
системы такие значения использовать не рекомендуется.

Подробнее о линиях см. разделы "Параметры линий" и "Добавление линии"
в руководстве по эксплуатации.

~1<br />
Не более, чем `*таймаут запроса новых событий* (40 мс по умолчанию) * 127`.

<!--
TODO line properties - *config applied* param shown when:
- has *config* applied
- proto: orion

- port
- protocol
- speed
- query devices
- timeouts
  - [s2k-eth-re 2.2.5.4 Требования и рекомендации по настройке временных параметров p27]()
  - [s2k-eth-re 2.2.5.4.2 Настройка временных параметров p30]()
  - short descr of new events requests timeout tradeoffs
- options `ORIG` not described in [s3k-re]
- => after a while s2km should appear in device list
 2ASK: 40 ms (default val) * 127 = 5080 ms
-->
<!--
Подробнее о параметрах таймингов см. в руководстве по эксплуатации
**s2k-eth** ("Требования и рекомендации по настройке временных параметров"
и "Настройка временных параметров").
-->



## Работа с конфигурациями пультов

<!-- ### intro -->

Для отображения состояния приборов, задействованных
в **iso** и управления ими в **s3k** требуется
доступ к конфигурации пульта.

Эта конфигурация включает в себя также информацию о
зонах, группах зон, сотрудниках, паролях и уровнях доступа.

Создание и редактирование такой конфигурации
(с возможностью экспорта в файл)
осуществляется с помощью утилиты `PProg`.

Для устройств, подключенных напрямую (без участия пульта)
также необходима конфигурация, созданная в `PProg`.

<!--
для дальнейшего использования обеспечивается с помощью
- why we need saved s2km *config*
  - view event log
  - view/control
-->

### Сохранение пульта в базе данных **s3k**

Работа с конфигурациями начинается с сохранения пульта в базе данных **s3k**.

На странице
*`Конфигурирование структуры объекта`* → *`Приборы`* → *`Линии и протоколы`*
необходимо выбрать нужную линию, затем пульт
и нажать кнопку "Сохранить в БД" в правой части окна.

<!-- SS -->

После успешного добавления в списке устройств рядом с пультом
будет отображаться значок с изображением базы данных.

<!-- SS -->

**Примечание:**<br />
Описанная выше процедура добавления пульта в базу данных **s3k**
необходима для устройств, автоматически обнаруженных системой
(параметр линии "Включить опрос" установлен).
Добавленные вручную устройства
[s3k-re 2.3.5.4 p101]()
сохраняются в базе данных **s3k** при их добавлении.

- **Внимание:**<br /><!-- TODO move -->
Конфигурация, загруженная в **s3k** должна совпадать
с конфигурацией, сохраненной в устройстве пульта.

<!--
p. 91:
Устройства, подключенные к «АРМ С3000», можно сохранить в базу данных системы.
Сохранённые устройства опрашиваются с более высоким приоритетом.
Для сохранённых устройств рядом с названием отображается значок [db img].

Устройство можно добавить в базу данных вручную, создав новое
(п. 2.3.5.3.1.5 - Добавление устройств в базу данных вручную)
или
выбрать найденное устройство на линии и добавить его в базу данных
(п. 2.3.5.3.1.4 - Добавление устройств в базу данных при нахождении).

Устройства, добавленные в базу, будут всегда отображаться на линии
(не зависит от того, активны или неактивны),
при удалении линии сохраненные устройства на линии будут TODO так же удалены.

Для штатной работы необходимо применение конфигурации к подключенным устройствам.
Конфигурация может быть применена в режиме конфигурации (п. 2.3.5.1)
к следующим сущностям (подробнее о применении конфигурации в п. 2.3.5.3.1.6 ):
- к линии, которая работает по протоколу «Орион»
- к пульту, находящемуся на линии, которая работает по протоколу «Орион Про».
Такой пульт должен быть добавлен в базу данных «АРМ С3000».
-->

<!-- s3kq orig:
- 9 Конфигурация устройств                           - p. 13
    - 9.1 Чтение конфигурации из пульта              - p. 16
    - 9.2 Создание конфигурации для пульта           - p. 17
    - 9.3 Создание конфигурации для линии без пульта - p. 21
    - 9.4 Загрузка конфигураций в АРМ С3000          - p. 23
    - 9.5 Применение конфигураций в АРМ С3000        - p. 23
-->



### Загрузка конфигурации пульта в **s3k**

В программе `PProg` нужно экспортировать конфигурацию
(кнопка "Сохранить конфигурацию в файл") и загрузить полученный файл в **s3k**:

на странице *`Конфигурирование структуры объекта`* → *`Конфигурации`*
[s3k-re 2.3.5.4 p112]()
нажать кнопку "Войти в режим конфигурации", затем "Выберите файл" и "Загрузить".
В списке должно появиться имя загруженного файла и сопутствующая информация.

Закончив загрузку, следует нажать "Сохранить изменения в конфигурации".



### Чтение конфигурации из пульта, подключенного к **s3k**

<!-- *optional* *one of the ways to get s2km cfg* -->

При невозможности подключиться к пульту напрямую,
можно воспользоваться следующим способом,
соединившись с пультом через **s3k**, используя `PProg`:

- Выбрать в дереве устройств узел "TCP/IP", в контекстном меню нажать "Добавить".
- В диалоговом окне указать IP-адрес машины с установленным **s3k**
  и номер порта (80 порт для соединения по протоколу HTTP, 443 - для HTTPS).
- Если соединение установлено успешно, в открывшемся окне "Авторизация на С3000-Hub"
  ввести имя пользователя и пароль. Пользователь с ролью "service" должен быть
  предварительно создан в web-интерфейсе **s3k** на странице
  *`Конфигурирование структуры объекта`* → *`Пользователи`*.
  [s3k-re 2.3.5.2 Страница «Пользователи» p81]()
- Выбрать в дереве нужный пульт и нажать кнопку "Считать конфигурацию из пульта"
  на панели инструментов, введя при запросе пароль, установленный на пульте.
- TODO save to file
  [### "Загрузка конфигурации пульта в **s3k**" above]()



### Применение загруженной конфигурации к пульту

Для применения конфигурации ее прежде необходимо загрузить на сервер.
[### "Загрузка конфигурации пульта в **s3k**" above]()

На странице
*`Конфигурирование структуры объекта`* → *`Приборы`* → *`Линии и протоколы`*
выбрать нужную линию, затем пульт и нажать кнопку "Войти в режим конфигурации".

После этого станет доступна кнопка "Конфигурации" в правой части окна.
При нажатии откроется окно со списком доступных конфигурационных файлов.
[### "Загрузка конфигурации пульта в **s3k**" above]()

Выбрав из списка нужный, нажатием на кнопку "Сохранить" мы применяем
конфигурацию к пульту.

Выйти из режима конфигурации, нажав "Сохранить изменения в конфигурации".

В случае успеха, на странице *`Штатная работа`* → *`Состояние объекта`*
появятся элементы, зоны и группы зон, считанные из примененной конфигурации.



### Применение загруженной конфигурации к линии без пульта

Действия по применению конфигурации к линии без пульта аналогичны
приведенным выше с той лишь разницей, что производятся они
на странице свойств линии.



## Добавление пользователей

Учетные записи пользователей web-интерфейса настраиваются на странице
*`Конфигурирование структуры объекта`* → *`Пользователи`*.

Изначально в системе присутствует только встроенная запись
для пользователя "admin".

Существует два типа учетных записей (*ролей*): "service" и "operator".
*Роль* определяет набор действий, доступных данному пользователю.

Пользователю с ролью "service" доступен весь функционал **s3k**.

Роль "operator" ограничивает права,
а также число отображаемых компонентов web-интерфейса.

Пользователь с такой ролью будет иметь доступ лишь к этим страницам:
- *`Штатная работа`*
- *`Общая настройка`* → *`Подключения`*
- *`Конфигурирование структуры объекта`* → *`Пользователи`*.

Подробнее см.
[s3k-re 2.3.5.2 Страница Пользователи p81]()

<!--
Роль "operator"
ограничивает
права пользователя
и
вводит ограничения

число
доступных
  видимых
  возможных
    действий
компонентов web-интерфейса
пользователь
с такой ролью
будут видны
лишь эти
страницы

Роль "service" позволяет
создавать, редактировать и удалять других пользователей.
создавать, редактировать и удалять учетные записи.
,
пользователь же с ролью "operator" такой возможности лишен.

(пользователя "admin" удалить нельзя).
Пользователь добавляется нажатием на кнопку "Новый".
Пользователь с ролью "operator"
такой возможности лишен
и может только
Существует два типа учетных записей по числу *ролей*: "service" и "operator".
TODO
- доступ из программ: UProg, PProg или Shleifes.
- can change own password

TODO 2ASK
- сброс пароля к настройкам по умолчанию
- `WhereTF` сброс к исходным настройкам описан в документах по установке для разных систем
-->



## Рассылка уведомлений. Telegram

**s3k** позволяет организовать удаленное взаимодействие оператора с системой
через сеть Интернет, используя для этого *чат-боты* мессенджера Telegram.

*Боты* Telegram представляют собой специальные программы,
применяемые для задач сбора данных и автоматизации.

С точки зрения пользователя мессенджера,
бот выглядят как обычный собеседник в чате,
но способный реагировать на ряд определенных *команд*
(команды могут отдаваться боту как в виде текстовых сообщений,
так и посредством элементов пользовательского интерфейса -
кнопок, меню и т.д.).

В нашем случае речь идет о боте, способном доставлять сообщения о происходящих
на объекте событиях и отдавать команды управления приборами **iso**
(например, "взять под охрану" или "сбросить тревоги").

Для использования этой возможности необходимо наличие
подключения к сети Интернет и учетной записи пользователя Telegram.

Настройка включает в себя следующие действия:
- создание канала уведомлений, фильтров
- создание бота
- регистрация созданного бота в **s3k**
- создание пользователя для работы с ботом

### Канал уведомлений

События, включаемые в состав уведомлений,
определяются так называемым "каналом уведомлений" (КУ) - определенным набором фильтров.
Каждый фильтр содержит правила отбора интересующих событий по различным критериям.
Примером может служить получение уведомлений о
"пожарах и включениях автоматики в зонах №1 и №2".

Фильтры событий настраиваются на странице
*`Конфигурирование структуры объекта`* → *`Рассылка уведомлений`*,
вкладка "Каналы уведомлений".

[s3k-re 2.3.5.7.1 Вкладка Каналы уведомлений p129]()

### Создание бота

Бот создается в клиентской программе Telegram
(существуют версии для ПК и мобильных устройств).

- Найти пользователя (бота) с именем `@BotFarther`.
  Убедиться, что найденная учетная запись имеет официальный статус
  (рядом с именем находится подтверждающий значок).

<!-- SS -->

- Начать работу с ботом, нажав на "START".
- В полученном сообщении содержится список доступных команд,
  исполняемых ботом. Следует выбрать команду "/newbot".
- Далее следуют два вопроса с предложением
  задать отображаемое имя и имя пользователя,
  которое должно оканчиваться на "bot", например,
  "MyS3000bot".
- При успешном выполнении будет получено сообщение
  со сведениями о созданном боте, включая имя, ссылку и *токен*.
  Токен представляет собой строку, используемую для авторизации
  и управления ботом и является конфиденциальной информацией.

<!-- SS -->

[s3k-re 2.3.5.7.3 Настройка нового бота Telegram p134]()

### Регистрация созданного бота в **s3k**

На странице
*`Конфигурирование структуры объекта`* → *`Рассылка уведомлений`*
(вкладка "Телеграм")
следует нажать на кнопку "Добавить нового бота" и заполнить
поля с параметрами, из которых обязательным является "Токен бота"
(вводится строка токена, полученная на предыдущем шаге).

**Примечание:**<br />
Если в сети используется прокси-сервер,
его параметры необходимо указать на странице свойств бота:
следует иметь в виду, что установки прокси-сервера,
заданные в свойствах системы (например, в ОС Windows),
не принимаются во внимание при работе **s3k** с Telegram.

После добавления и в случае установления соединения с
сервером Telegram рядом с именем в списке ботов
должен отобразиться значок зеленого цвета, что
говорит об успешном завершении операции.
Теперь можно приступить к созданию пользователя бота.

### Создание пользователя для работы с ботом

- Нажать на странице свойств бота кнопку вызова меню в правом верхнем углу
  и выбрать пункт "Список пользователей".
- Добавить нового пользователя (кнопка слева сверху), после чего
  ввести "Пользовательское описание" (фактически - отображаемое имя)
  и нажать "Добавить".
- На открывшейся затем странице "Информация для привязки"
  перейти по ссылке (или сканировать QR-код) для авторизации в Telegram.
  Поля "информации для привязки" (ссылка, QR-код) доступны также
  на странице "Редактирование пользователя".
  Если "привязка" (то есть авторизация) пользователя не была проведена,
  его статус будет показан как "Ожидает связывания".
- Открыв вновь список пользователей и отредактировав нужного,
  задать набор уведомлений, которые он будет получать, -
  выбрав канал уведомлений в поле "Привязан к".



- [info on bots](https://core.telegram.org/bots) + bots, telegram intro (rus)?
- create bot
  - goto https://t.me/botfather (@BotFather)
  - START
    - a message with available commands
  - /newbot (here on henceforth: either command or menu)
  - enter name (display name)
  - enter bot's *username*: must end with "bot" (NB "-" are not allowed)
  - => "Done!" message:
    - t.me link to bot
    - http api access token // to control a bot // keep it secure
- add bot in web-interface: *`Конфигурирование структуры объекта`* →
  *`Рассылка уведомлений`* → *`Телеграм`*
  - button: "+"
  - enter token: "Токен бота"
  - proxy, if required: Прокси // [bolid]: **required** (won't pick up sys settings)
  - `2ASK` Лимиты/Таймауты - disabled?
  - greetings messages, if desired: Приветствие
  - button: "Создать"
- add user in web-interface
  - select bot
  - burger button -> Список пользователей -> user+ button
- *`Конфигурирование структуры объекта`* →
  *`Рассылка уведомлений`* → *`Каналы уведомлений`* -> add
- goto: telegram user settings in web-interface
 - "Привязан к" -> канал уведомлений
- scan QR-code or follow a link => user is "bound"

